function payBackButton(){$("#p-pay").find(".pay-back").click(function(){$.confirm("是否确定取消订单?",function(){deleteOrder()})})}function deleteOrder(){$.ajax({type:"post",url:luanmingli.getUrl+"deleteOrder",data:{_method:"delete",v:luanmingli.srvVersion,content:encryptByDES(JSON.stringify({orderId:luanmingli.orderInfo.orderId}))},async:!0,dataType:"json",success:function(n){0==n.stateCode?$.router.back():$.alert(n.message,function(){$.router.back()})}})}function payFillData(){if(luanmingli.canUseBonus){luanmingli.bonusUseCheckboxOld&&$(".bonus-right-box").html(luanmingli.bonusUseCheckboxOld),$(".p-bonus-ipt").prop("checked",!0),$(".p-bonus-ipt").attr("name",luanmingli.canUseBonus.userHongbaoId),$(".z_pay_bonus").html(luanmingli.canUseBonus.disCount);var n=luanmingli.canUseBonus.disCount}else n=0,luanmingli.bonusUseCheckboxOld=$(".bonus-right-box").html(),$(".bonus-right-box").html("暂无可用红包");var e=luanmingli.orderInfo.cost-n,o=luanmingli.userInfo.detailInfo.points,i=o>=e?e:o;0==o?($(".p-gold-ipt").attr("disabled","disabled"),$(".p-gold-ipt-icon").addClass("cannotCheckBG")):$(".p-gold-ipt").prop("checked",!0),$(".z_pay_money").html(luanmingli.orderInfo.cost),i<0&&(i=0),$(".z_pay_gold").html(i);var a=e-i;a<0&&(a=0),$(".z_pay_money_left").html(a),e-i==0?($(".p_checkbox").find(".icon-form-checkbox").addClass("cannotCheckBG"),$(".p_checkbox").find(".item-inner").addClass("cannotCheckC"),$(".p_checkbox").find("input").attr("disabled","disabled")):($(".p_checkbox").find(".icon-form-checkbox").removeClass("cannotCheckBG"),$(".p_checkbox").find(".item-inner").removeClass("cannotCheckC"),$(".p_checkbox").find("input").removeAttr("disabled","disabled"));var t=e-i;$(".p-gold-ipt-icon").click(function(){var e=luanmingli.orderInfo.cost-n,o=luanmingli.userInfo.detailInfo.points,i=o>=e?e:o;if(0!=o){var a;return $(".p-gold-ipt").is(":checked")?($(".p-gold-ipt").prop("checked",!1),$(".p_checkbox").find(".icon-form-checkbox").removeClass("cannotCheckBG"),$(".p_checkbox").find(".item-inner").removeClass("cannotCheckC"),$(".p_checkbox").find("input").removeAttr("disabled"),a=0,t=e):($(".p-gold-ipt").prop("checked",!0),a=i,t=e-i,0==t&&($(".p_checkbox").find(".icon-form-checkbox").addClass("cannotCheckBG"),$(".p_checkbox").find(".item-inner").addClass("cannotCheckC"),$(".p_checkbox").find("input").attr("disabled","disabled"))),a<0&&(a=0),$(".z_pay_gold").html(a),t<0&&(t=0),$(".z_pay_money_left").html(t),!1}}),$(".p-pay-button").click(function(){luanmingli.canUseBonus&&$(".p-bonus-ipt").is(":checked")?(bonusMoneyNum=luanmingli.canUseBonus.disCount,prePay(t,bonusMoneyNum)):prePay(t,0)})}function prePay(n,e){var o,i=function(){var n=$(".p-bonus-ipt").attr("name");return n?n:"0"};if(0==n){o=10;var a=luanmingli.orderInfo.cost-e;a<0&&(a=0),$.ajax({type:"post",url:luanmingli.getUrl+"prePay",data:{v:luanmingli.srvVersion,content:encryptByDES(JSON.stringify({way:o,orderId:luanmingli.orderInfo.orderId,userId:luanmingli.userId,secret:luanmingli.orderInfo.secret,points:a,channelId:luanmingli.channel,hongbaoId:i()}))},async:!0,dataType:"json",success:function(n){window.sessionStorage.setItem("paying",luanmingli.orderInfo.orderId),0==n.stateCode?checkPay():$.alert(n.message)}})}else if("zfb"==$(".p_pay_way").find("input[type=radio]:checked").attr("class")){o=2;var t="http://www.2333db.com/callback/callback_empty.html";(luanmingli.qktId||luanmingli.thirdId||navigator.userAgent.indexOf("QQ")>-1)&&(t=window.location.href+"?backId="+luanmingli.orderInfo.treasureId);if(luanmingli.orderInfo.cost==parseInt(n)+parseInt(e)){var r=luanmingli.getUrl+"prePay?v="+luanmingli.srvVersion+"&content="+encodeURIComponent(encryptByDES(JSON.stringify({way:o,orderId:luanmingli.orderInfo.orderId,userId:luanmingli.userId,secret:luanmingli.orderInfo.secret,points:0,goodsDetailUrl:t,paySuccessUrl:t,hongbaoId:i()})));luanmingli.qktId&&!luanmingli.qkt.backUrl||luanmingli.thirdId||navigator.userAgent.indexOf("QQ")>-1?window.location.href=r:window.open(r)}else{var l=luanmingli.getUrl+"prePay?v="+luanmingli.srvVersion+"&content="+encodeURIComponent(encryptByDES(JSON.stringify({way:o,orderId:luanmingli.orderInfo.orderId,userId:luanmingli.userId,secret:luanmingli.orderInfo.secret,points:n,goodsDetailUrl:t,paySuccessUrl:t,hongbaoId:i()})));luanmingli.qktId&&!luanmingli.qkt.backUrl||luanmingli.thirdId||navigator.userAgent.indexOf("QQ")>-1?window.location.href=l:window.open(l)}window.sessionStorage.setItem("paying",luanmingli.orderInfo.orderId),$.confirm("是否支付完成?",function(){checkPay()})}}function checkPay(){var n=luanmingli.orderInfo.orderId,e=luanmingli.orderInfo.secret;$.ajax({type:"post",url:luanmingli.getUrl+"postPayInfo",data:{v:luanmingli.srvVersion,content:encryptByDES(JSON.stringify({orderId:n,secret:e}))},async:!0,dataType:"json",success:function(n){window.sessionStorage.removeItem("orderInfo"),n&&0==n.stateCode?$.router.load("pay-success.html"):$.router.load("pay-fail.html")}})}$(function(){try{luanmingli.orderInfo=$.parseJSON(window.sessionStorage.getItem("orderInfo")),window.sessionStorage.getItem("canUseBonus")?luanmingli.canUseBonus=$.parseJSON(window.sessionStorage.getItem("canUseBonus")):luanmingli.canUseBonus=!1,(navigator.userAgent.indexOf("UCBrowser")>-1||!supportCss3("justify-content"))&&($(".p_money_num").addClass("UC-pay"),$(".p_pay_way").addClass("UC-pay")),payFillData(),payBackButton(),null!=window.sessionStorage.getItem("paying")&&$.confirm("是否支付完成?",function(){checkPay()})}catch(n){}});