function payBackButton(){$("#p-pay").find(".pay-back").click(function(){$.confirm("是否确定取消订单?",function(){deleteOrder()})})}function deleteOrder(){$.ajax({type:"post",url:lData.getUrl+"deleteOrder",data:{_method:"delete",v:lData.srvVersion,content:encryptByDES(JSON.stringify({orderId:lData.orderInfo.orderId}))},async:!0,dataType:"json",success:function(e){0==e.stateCode?$.router.back():$.alert(e.message,function(){$.router.back()})}})}function payFillData(){if(lData.canUseBonus){lData.bonusUseCheckboxOld&&$(".bonus-right-box").html(lData.bonusUseCheckboxOld),$(".p-bonus-ipt").prop("checked",!0),$(".p-bonus-ipt").attr("name",lData.canUseBonus.userHongbaoId),$(".z_pay_bonus").html(lData.canUseBonus.disCount);var e=lData.canUseBonus.disCount}else e=0,lData.bonusUseCheckboxOld=$(".bonus-right-box").html(),$(".bonus-right-box").html("暂无可用红包");var a=lData.orderInfo.cost-e,t=lData.userInfo.detailInfo.points,o=t>=a?a:t;0==t?($(".p-gold-ipt").attr("disabled","disabled"),$(".p-gold-ipt-icon").addClass("cannotCheckBG")):$(".p-gold-ipt").prop("checked",!0),$(".z_pay_money").html(lData.orderInfo.cost),o<0&&(o=0),$(".z_pay_gold").html(o);var n=a-o;n<0&&(n=0),$(".z_pay_money_left").html(n),a-o==0?($(".p_checkbox").find(".icon-form-checkbox").addClass("cannotCheckBG"),$(".p_checkbox").find(".item-inner").addClass("cannotCheckC"),$(".p_checkbox").find("input").attr("disabled","disabled")):($(".p_checkbox").find(".icon-form-checkbox").removeClass("cannotCheckBG"),$(".p_checkbox").find(".item-inner").removeClass("cannotCheckC"),$(".p_checkbox").find("input").removeAttr("disabled","disabled"));var r=a-o;$(".p-gold-ipt-icon").click(function(){var a=lData.orderInfo.cost-e,t=lData.userInfo.detailInfo.points,o=t>=a?a:t;if(0!=t){var n;return $(".p-gold-ipt").is(":checked")?($(".p-gold-ipt").prop("checked",!1),$(".p_checkbox").find(".icon-form-checkbox").removeClass("cannotCheckBG"),$(".p_checkbox").find(".item-inner").removeClass("cannotCheckC"),$(".p_checkbox").find("input").removeAttr("disabled"),n=0,r=a):($(".p-gold-ipt").prop("checked",!0),n=o,r=a-o,0==r&&($(".p_checkbox").find(".icon-form-checkbox").addClass("cannotCheckBG"),$(".p_checkbox").find(".item-inner").addClass("cannotCheckC"),$(".p_checkbox").find("input").attr("disabled","disabled"))),n<0&&(n=0),$(".z_pay_gold").html(n),r<0&&(r=0),$(".z_pay_money_left").html(r),!1}}),$(".p-pay-button").click(function(){lData.canUseBonus&&$(".p-bonus-ipt").is(":checked")?(bonusMoneyNum=lData.canUseBonus.disCount,prePay(r,bonusMoneyNum)):prePay(r,0)})}function prePay(e,a){var t,o=function(){var e=$(".p-bonus-ipt").attr("name");return e?e:"0"};if(0==e){t=10;var n=lData.orderInfo.cost-a;n<0&&(n=0),$.ajax({type:"post",url:lData.getUrl+"prePay",data:{v:lData.srvVersion,content:encryptByDES(JSON.stringify({way:t,orderId:lData.orderInfo.orderId,userId:lData.userId,secret:lData.orderInfo.secret,points:n,channelId:lData.channel,hongbaoId:o()}))},async:!0,dataType:"json",success:function(e){window.sessionStorage.setItem("paying",lData.orderInfo.orderId),0==e.stateCode?checkPay():$.alert(e.message)}})}else if("zfb"==$(".p_pay_way").find("input[type=radio]:checked").attr("class")){t=2;var r="http://www.2333db.com/callback/callback_empty.html";(lData.qktId||lData.thirdId||navigator.userAgent.indexOf("QQ")>-1)&&(r=window.location.href+"?backId="+lData.orderInfo.treasureId);if(lData.orderInfo.cost==parseInt(e)+parseInt(a)){var s=lData.getUrl+"prePay?v="+lData.srvVersion+"&content="+encodeURIComponent(encryptByDES(JSON.stringify({way:t,orderId:lData.orderInfo.orderId,userId:lData.userId,secret:lData.orderInfo.secret,points:0,goodsDetailUrl:r,paySuccessUrl:r,hongbaoId:o()})));lData.qktId&&!lData.qkt.backUrl||lData.thirdId||navigator.userAgent.indexOf("QQ")>-1?window.location.href=s:window.open(s)}else{var c=lData.getUrl+"prePay?v="+lData.srvVersion+"&content="+encodeURIComponent(encryptByDES(JSON.stringify({way:t,orderId:lData.orderInfo.orderId,userId:lData.userId,secret:lData.orderInfo.secret,points:e,goodsDetailUrl:r,paySuccessUrl:r,hongbaoId:o()})));lData.qktId&&!lData.qkt.backUrl||lData.thirdId||navigator.userAgent.indexOf("QQ")>-1?window.location.href=c:window.open(c)}window.sessionStorage.setItem("paying",lData.orderInfo.orderId),$.confirm("是否支付完成?",function(){checkPay()})}}function checkPay(){var e=lData.orderInfo.orderId,a=lData.orderInfo.secret;$.ajax({type:"post",url:lData.getUrl+"postPayInfo",data:{v:lData.srvVersion,content:encryptByDES(JSON.stringify({orderId:e,secret:a}))},async:!0,dataType:"json",success:function(e){window.sessionStorage.removeItem("orderInfo"),e&&0==e.stateCode?$.router.load("pay-success.html"):$.router.load("pay-fail.html")}})}$(function(){try{lData.orderInfo=$.parseJSON(window.sessionStorage.getItem("orderInfo")),window.sessionStorage.getItem("canUseBonus")?lData.canUseBonus=$.parseJSON(window.sessionStorage.getItem("canUseBonus")):lData.canUseBonus=!1,(navigator.userAgent.indexOf("UCBrowser")>-1||!supportCss3("justify-content"))&&($(".p_money_num").addClass("UC-pay"),$(".p_pay_way").addClass("UC-pay")),payFillData(),payBackButton(),null!=window.sessionStorage.getItem("paying")&&$.confirm("是否支付完成?",function(){checkPay()})}catch(e){}});