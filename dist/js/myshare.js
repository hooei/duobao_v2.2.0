function myShareGetData(e){$.showIndicator(),$.ajax({type:"post",url:luanmingli.getUrl+"getShareOrder",data:{currentPage:e,userId:luanmingli.userId,v:luanmingli.srvVersion},async:!0,dataType:"json",success:function(e){0==e.stateCode?0==e.shareOrderList.length?0==$(".no-share").length&&$("#p-myshare").find(".content").append('<div class="no-share"><div class="content-block z_not_record"><div class="no_record">您还没有晒单记录哦</div><a class="back global_button button now_participate" style="line-height: 2.4rem;">返回</a></div></div>'):($.each(e.shareOrderList,function(e,t){$("#p-myshare").find(".content").append('<div onclick="goThisDuobao('+t.treasureId+');" class="list card"><div><div class="head"><p class="text2">'+t.sharedContent+'</p></div><div class="image-box clearfix">'+imageBoxSrc(t)+'</div><div class="info"><p class="text1">'+t.goodsName+'</p><p class="text2">期号:第'+t.phaseNumber+'期&nbsp;本期参与<span class="text-orange">'+t.buyCount+'</span>人次／总需<span class="text-orange">'+t.totalCount+'</span>人次</p></div><div class="foot"><span class="text">'+t.commitTime+'</span><span onclick="goNewDuobao('+t.treasureId+",'"+t.onSell+'\');" class="button">再次购买</span></div></div></div>')}),$(".div-image").height($(".div-image").width()),myshareTotlePage=e.totalPage,myshareBottomLoadmore(e.currentPage)):$.alert(e.message),setTimeout(function(){$.hideIndicator()},500)}})}function imageBoxSrc(e){var t=e.imagesThumb.split(","),o="";return $.each(t,function(t,a){a&&(o+="<div onclick=\"openPhotoBrowser('"+e.images+"',this,'"+e.sharedContent+'\');" class="div-image" style="background:url('+a+') center center no-repeat;background-size:cover;"></div>')}),o}function goThisDuobao(e){event.stopPropagation(),$.router.load("duobao.html?treasureId="+e)}function goNewDuobao(e,t){event.stopPropagation(),1==t?$.router.load("duobao.html?treasureId="+e+"&type=2"):$.alert("商品已下架")}function myShareRefresh(){$("#p-myshare").find(".list").remove(),myShareGetData(1)}function myshareBottomLoadmore(e){if(!(e>myshareTotlePage||1==myshareTotlePage)){$(document).off("infinite","#p-myshare .infinite-scroll");var t=!1;$(document).on("infinite","#p-myshare .infinite-scroll",function(){t||(t=!0,$.showIndicator(),setTimeout(function(){return myshareTotlePage&&e>=myshareTotlePage?void setTimeout(function(){$.hideIndicator(),$.toast("没有更多数据",1e3,"toast-80"),t=!1,$(document).off("infinite","#p-myshare .infinite-scroll")},200):(myShareGetData(e+1),void setTimeout(function(){$.hideIndicator(),$.toast("加载成功",1e3,"toast-80"),t=!1},200))},200))})}}function openPhotoBrowser(e,t,o){event.stopPropagation();var a=e.split(","),s=new Array;$.each(a,function(e,t){s.push({url:t,caption:o})}),_getCss("libs/msui-extend.min.css",function(){_getJs("libs/msui-extend.min.js",function(){$.photoBrowser({photos:s,type:"popup"}).open($(t).index()),$(".popup.photo-browser-popup .bar-nav").addClass("c_header")})})}$(function(){try{if($("#p-myshare").find(".list").length>0&&!window.sessionStorage.getItem("myshareForceRefresh"))return;1==window.sessionStorage.getItem("myshareForceRefresh")&&($("#p-myshare").find(".list").remove(),window.sessionStorage.removeItem("myshareForceRefresh")),myShareGetData(1),dropRefresh("#p-myshare",myShareRefresh)}catch(e){}});