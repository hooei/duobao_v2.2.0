function indexFixedTab(){if(2==indexFixedTabFlag){var e=2*parseInt($("html").css("font-size"));$(".a-tab-list").fixedTab({offset:e}),window.sessionStorage.setItem("indexFiedTop",$("#p-index .pull-to-refresh-layer").height()+$("#p-index .swiper-container").height()+$("#scrollInfo").height())}else setTimeout(function(){indexFixedTab()},100)}function cardHeight(){var e=$("#p-index .index_model .card-header .card-cover");e.height(.655817*e.width())}function scrollInfo(){0==$("#scrollInfo").length?$.get(lData.getUrl+"getLuckyInfo?v="+lData.srvVersion,function(e){var t=0;$("<div style=\"width:100%;overflow-x:hidden;\"><div ontouchmove='javascript:event.preventDefault();' id='scrollInfo'><div class='scroll-image'></div><div class='scrolltestbar'><div class='scrolltext-box'></div></div</div></div>").insertAfter($("#p-index .swiper-container")),$.each(e.notiInfoList,function(i){$("<div class='scrolltext' style='color:#b0b0b0;'>恭喜<span class='a8'>"+e.notiInfoList[i].nickName+"</span>"+e.notiInfoList[i].luckyTime+"前获得<span style='color:#5d5d5d;'>"+e.notiInfoList[i].goodsTitle+"</span></div>").appendTo($("#scrollInfo").find(".scrolltext-box")),t+=$(".scrolltext").eq(i).width()}),$(".scrolltext-box").width(t+30),$("#scrollInfo").width($(".scrolltext-box").width()-$("body").width());var i=null;if($.device.android&&!i){$(".scrolltext-box").css("height","100%").removeClass("scrolltext-box").addClass("scrolltext-box2");var a=0;i&&clearInterval(i),$("#scrollInfo").css("width","100%"),i=setInterval(function(){a+=1,$(".scrolltestbar").scrollLeft(a),$(".scrolltestbar").scrollLeft()>=$(".scrolltext-box2").width()-$("body").width()-5&&(a=0)},20)}indexFixedTabFlag+=1}):indexFixedTabFlag+=1}function tabClick(){$(".a-tab-list").find("a").click(function(){$(this).hasClass("active")||(clickNoLoadmore=1,$(".pull-to-refresh-content").scrollTop(0),$(".i_load_more").html("加载更多&darr;"),$(".a-tab-list a").removeClass("active"),$(this).addClass("active"),$(".index-active").hide(),$("#index-active-"+$(this).index()).show(),tabSelect($(this).index(),1))})}function tabSelect(e,t){$("#index-active-"+e).find(".index_model").length>0&&null==window.sessionStorage.getItem("indexForceRefresh")||null!=window.sessionStorage.getItem("indexForceRefresh")&&window.sessionStorage.getItem("indexForceRefresh").indexOf(e)==-1||($("#index-active-"+e).find(".index_model").remove(),0==e?indexFillData(e,t,2):1==e?indexFillData(e,t,3):2==e&&indexFillData(e,t,1),indexBottomLoadmore())}function indexFillData(e,t,i,a){$.showIndicator(),$.ajax({type:"get",url:lData.getUrl+"getTreasureList",data:{currentPage:t,order:i,v:lData.srvVersion,type:1},async:!0,dataType:"json",success:function(i){if(!(t>i.totalPage)){if(lData.indexTotalPage[e]=i.totalPage,$.each(i.treasureInfoList,function(t,i){appendData($("#index-active-"+e),i)}),null!=window.sessionStorage.getItem("indexForceRefresh")){var n=window.sessionStorage.getItem("indexForceRefresh").split(","),o=$.map(n,function(t){return t==e?null:t});0==o.length?window.sessionStorage.removeItem("indexForceRefresh"):window.sessionStorage.setItem("indexForceRefresh",o)}a&&a(),setTimeout(function(){i.totalPage>1&&$(".i_load_more").show(),$.hideIndicator()},200)}}})}function appendData(e,t){$(e).append('<div onclick="routerToDuobao('+t.treasureId+')" name="'+t.treasureId+'" class="index_model card"><div valign="bottom" class="card-header color-white no-border no-padding"><div class="card-cover" style="background:url('+t.goodsInfo.picUrl+') center center no-repeat;background-size:contain;"></div></div><div class="card-content"><div class="card-content-inner list_info"><div class="clearfix stage_info"><p class="stage_text"><span>'+t.goodsInfo.describe+'</span></p></div><div class="clearfix"><div class="schedule pull-left clearfix"><div class="schedule_bar"><div class="scheduling" style="width:'+t.participantCount/t.totalCount*100+'%;"></div></div><div class="pull-left"><p class="schedule_percent">'+t.totalCount+'</p><p>总需</p></div><div class="schedule_text2 pull-right"><p class="schedule_person">'+(t.totalCount-t.participantCount)+'</p><p>剩余</p></div></div><button class="global_button participate button pull-right">立即夺宝</button></div></div></div></div>')}function indexRefresh(){var e=$(".a-tab-list").find(".active").index();window.sessionStorage.setItem("indexForceRefresh",[e]),tabSelect(e,1),$(".i_load_more").html("加载更多&darr;"),window.sessionStorage.removeItem("indexLoadFinish")}function indexBottomLoadmore(){$(document).off("infinite","#p-index .infinite-scroll");var e=!1;$(document).on("infinite","#p-index .infinite-scroll",function(){if(!e){var t=$(".a-tab-list").find(".active").index(),i=$("#index-active-"+t).find(".index_model").length,a=Math.ceil(i/10);if(1==indexLoadFinish[t]){window.sessionStorage.setItem("indexLoadFinish",indexLoadFinish),$(".i_load_more").html("没有更多数据");var n=[];return void $.each($("#index-active-"+t).find(".index_model"),function(e,t){$.inArray($(t).attr("name"),n)<0?n.push($(t).attr("name")):$(t).remove()})}i<10||(e=!0,$.showIndicator(),setTimeout(function(){function n(){setTimeout(function(){$.hideIndicator(),$.toast("加载成功",1e3,"toast-80"),setTimeout(function(){e=!1},500)},100)}var o=Math.ceil(i/10)+1;if(o>lData.indexTotalPage[t])return void setTimeout(function(){$.hideIndicator(),$.toast("没有更多数据",1e3,"toast-80"),$(".i_load_more").html("没有更多数据"),setTimeout(function(){e=!1},500),indexLoadFinish[t]=1},200);var o=a+1;0==t?indexFillData(t,o,2,n()):1==t?indexFillData(t,o,3,n()):2==t&&indexFillData(t,o,1,n())},100))}})}function routerToDuobao(e){$.showIndicator(),$.router.load("duobao.html?treasureId="+e)}function swiperBanner(){$("#p-index .swiper-container .swiper-slide img").length>0?indexFixedTabFlag+=1:fillBanner()}function bannerClickFuc(e){return/extract/.test(e)&&!lData.userId?void $.alert("请先登陆",function(){$.router.load("personal.html")}):void $.router.load(e)}function fillBanner(e){var t=lData.calcTestUrl?"extract.html?test=1&userId="+lData.userId+"&userKey="+window.localStorage.getItem("userKey")+"&from=web":"extract.html?userId="+lData.userId+"&userKey="+window.localStorage.getItem("userKey")+"&from=web",i=[{bannerUrl:"iframe.html?url=http://www.2333db.com/activity/act-register.html?backurl="+lData.bannerBackUrl,webImage:"img/banner-register.jpg"},{bannerUrl:"iframe.html?url=http://www.2333db.com/activity/act-recharge.html?backurl="+lData.bannerBackUrlRecharge,webImage:"img/banner-recharge.jpg"},{bannerUrl:"iframe.html?url=http://www.2333db.com/html/"+t,webImage:"img/banner-card.jpg"}];/127.0.0.1/.test(window.location.href)&&(i[0].bannerUrl="iframe.html?url=http://127.0.0.1:8020/duobao_v"+lData.version+"/other/src/act-register.html?backurl=http://127.0.0.1:8020/duobao_v"+lData.version+"/src/register.html",i[1].bannerUrl="iframe.html?url=http://127.0.0.1:8020/duobao_v"+lData.version+"/other/src/act-recharge.html?backurl=http://127.0.0.1:8020/duobao_v"+lData.version+"/src/personal.html",i[2].bannerUrl="iframe.html?url=http://127.0.0.1:8020/duobao_v"+lData.version+"/other/html/"+t),$.each(i,function(e,t){$("#p-index .swiper-container .swiper-wrapper").append('<div class="swiper-slide"><a onclick="bannerClickFuc(\''+t.bannerUrl+'\')"><img src="'+t.webImage+'" alt=""></a></div>')}),_getScript("libs/msui-extend.min.js",function(){_getCss("libs/msui-extend.min.css",function(){$(".swiper-container").swiper({pagination:".swiper-pagination",slidesPerView:1,paginationClickable:!0,spaceBetween:0,centeredSlides:!0,autoplay:3e3,autoplayDisableOnInteraction:!1}),indexFixedTabFlag+=1})})}$(function(){try{lData.indexTotalPage=[],$(".alert-resiger-bonus .alert-close").click(function(){$(".alert-resiger-bonus").hide()}),$(".alert-resiger-bonus .alert-button").click(function(){var e="iframe.html?url=http://www.2333db.com/activity/act-register.html?backurl="+lData.bannerBackUrl;/127.0.0.1/.test(window.location.href)&&(e="iframe.html?url=http://127.0.0.1:8020/duobao_v2.1.0/other/src/act-recharge.html?backurl=http://127.0.0.1:8020/duobao_v2.1.0/src/register.html"),$.router.load(e)}),$(".save-to-desktop").find(".icon-close").click(function(){$(".save-to-desktop").hide()}),window.indexFixedTabFlag=0,scrollInfo(),swiperBanner(),tabClick(),tabSelect(0,1),dropRefresh("#p-index",indexRefresh),indexFixedTab()}catch(e){}});var clickNoLoadmore;if(window.sessionStorage.getItem("indexLoadFinish"))var indexLoadFinish=window.sessionStorage.getItem("indexLoadFinish").split(",");else var indexLoadFinish=new Array(3);