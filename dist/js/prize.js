function prizeGetData(e,i){$.showIndicator(),$.ajax({type:"post",url:luanmingli.getUrl+"getMyPrize",data:{userId:luanmingli.userId,currentPage:e,v:luanmingli.srvVersion},async:!0,dataType:"json",success:function(e){0==e.stateCode?(0==e.prizeList.length&&1==e.currentPage?noPrize():($("#p-prize").find(".z_not_record").length>0&&$("#p-prize").find(".z_not_record").remove(),luanmingli.prizeTotlePage=e.totalPage,window.sessionStorage.setItem("prize"+e.currentPage,JSON.stringify(e)),havePrize(e)),window.sessionStorage.removeItem("prizeForceRefresh"),i&&i(),setTimeout(function(){$.hideIndicator()},500)):$.alert(e.message)}})}function noPrize(){$("#p-prize").find(".z_not_record").length>0||$("#p-prize").find(".content").append('<div class="content-block z_not_record"><div class="no_record">您还没有获奖记录哦</div><button onclick="prizeBackhome();" class="global_button button now_participate">立即夺宝</button></div>')}function prizeBackhome(){$.router.load("index.html")}function havePrize(e){$.each(e.prizeList,function(e,i){$("#p-prize").find(".content").append('<div onclick="prizeToDuobaoOld('+i.treasureId+');" class="card z_my_prize_model"><div class="card-content"><div class="list-block media-list"><ul><li class="item-content clearfix"><div class="item-media prize_image" style="background-image:url('+i.icon+');"></div><div class="item-inner clearfix"><div class="item-title-row"><div class="item-title z_prize_title">'+i.description+'</div></div><div class="item-subtitle z_prize_content"><p>期号：'+i.phaseNumber+"</p><p>总需："+i.totalCount+"人次</p><p>幸运号码："+i.luckyCode+"</p><p>本期参与："+i.buyCount+'人次<span style="padding:.3rem;margin-left:.3rem;color:#359df5;" onclick="prizeToLotteryDetail('+i.treasureId+",'"+encodeURIComponent(i.description)+"',"+i.phaseNumber+",'"+i.lotteryTime+"',"+i.luckyCode+","+i.buyCount+')">查看详情</span></p><p>揭晓时间：'+i.lotteryTime+'</p></div></div></li></ul></div></div><div class="card-footer"><span></span><span><span onclick="prizeAward('+e+",this,"+i.goodstype+","+i.treasureId+');" class="btn btn1 '+hasdoneClass(i.hasdone,i.goodstype,i.shared)+'">'+hasdoneText(i.hasdone,i.goodstype,i.shared)+"</span></span></div></div>")})}function prizeToDuobaoOld(e){$.router.load("duobao.html?treasureId="+e)}function prizeToLotteryDetail(e,i,t,r,o,n){event.stopPropagation(),$.router.load("buydetail.html?treasureId="+e+"&name="+i+"&phase="+t+"&time="+r+"&lucky="+o+"&count="+n)}function hasdoneText(e,i,t){if(2==i||202==i||203==i)return"奖品详情";if(0==e)return"确认收货地址";if(2==e)return"等待商品派发";if(3==e)return"确认收货";if(1==e){if(0==t)return"晒单";if(1==t)return"已晒单";if(2==t)return"晒单金币已派发";if(3==t)return"已晒单"}}function hasdoneClass(e,i,t){return 2==e||1==e&&0!=t?"btn3":""}function prizeAward(e,i,t,r){event.stopPropagation();var o=Math.ceil($(i).parents(".z_my_prize_model").index()/10),n=$.parseJSON(window.sessionStorage.getItem("prize"+o));window.sessionStorage.setItem("prizeInfo",JSON.stringify(n.prizeList[e])),window.sessionStorage.setItem("prizeAddress",JSON.stringify(n.userAddressList)),2==t?$.router.load("award-point.html"):202==t||203==t?$.router.load("award-card.html",!0):$.router.load("award.html")}function shareButton(e,i,t,r,o){1==i&&1==o&&(event.stopPropagation(),0==t&&$.router.load("share-help.html?treasureId="+e+"&goodsinfo="+r))}function prizeShare(){event.stopPropagation(),$.alert("TODO")}function prizeRefresh(){luanmingli.prizeNomore="",$("#p-prize").find(".z_my_prize_model").remove(),prizeGetData(1)}function prizeBottomLoadmore(){$(document).off("infinite","#p-prize .infinite-scroll");var e=!1;$(document).on("infinite","#p-prize .infinite-scroll",function(){e||luanmingli.prizeNomore||$("#p-prize").find(".content").find(".card").length<10||(e=!0,$.showIndicator(),setTimeout(function(){var i=Math.ceil($("#p-prize").find(".content").find(".card").length/10)+1;return i>luanmingli.prizeTotlePage?void setTimeout(function(){luanmingli.prizeNomore=!0,$.hideIndicator(),$.toast("没有更多数据",1e3,"toast-80"),e=!1},200):void prizeGetData(i,function(){setTimeout(function(){$.hideIndicator(),$.toast("加载成功",1e3,"toast-80"),e=!1},100)})},100))})}$(function(){try{if(window.sessionStorage.removeItem("awardCardRadioCardFinish"),window.sessionStorage.removeItem("awardCardRadioGoldFinish"),window.sessionStorage.removeItem("awardCardJdFinish"),null==window.sessionStorage.getItem("prizeForceRefresh")&&$("#p-prize").find(".z_my_prize_model").length>0)return;1==window.sessionStorage.getItem("prizeForceRefresh")&&(prizeRefresh(),window.sessionStorage.removeItem("prizeForceRefresh")),prizeGetData(1),dropRefresh("#p-prize",prizeRefresh),prizeBottomLoadmore()}catch(e){}});