var requestInit=function(){results.init(),dropRefresh("#p-results",results.refresh)},results=function(t){var e=function(e,r){t.ajax({type:"post",url:lData.getUrl+"getLotteryTreasure",data:{v:lData.srvVersion,currentPage:e},async:!0,dataType:"json",success:function(e){0==e.stateCode?(totalPage=e.totalPage,0==e.treasureList||(n(e),a(),o(e.currentPage),r&&r())):t.alert(e.message)}}),t.hideIndicator()},n=function(e){t.each(e.treasureList,function(e,n){t("#p-results .results-list").append('<li onclick="results.toDetail('+n.treasureId+')"><div class="results-img" style="background:url('+n.picUrl+') center center no-repeat;background-size:contain;"></div><p class="results-title">'+n.goodsName+"</p>"+function(t){return 1e3*t.opencode>(new Date).getTime()?'<div class="results-1"><p class="text-1">期号：第'+t.phaseNumber+'期</p><p class="text-2">即将揭晓</p><div class="text-3 remaining" name="'+t.remainingTime+'"></div></div>':'<div class="results-2"><p class="text-1">期号：第'+t.phaseNumber+'期</p><p class="text-2">获得者：<span style="color: #359df5;">'+t.luckyUserName+"</span></p><p>参与人次："+t.buyCount+'人次</p><p>幸运号码：<span style="color: #fb4748;">'+t.luckyCode+"</span></p><p>揭晓时间："+function(t){var e=t.split("-")[1]+"-"+t.split("-")[2],n=e.split(":")[0]+":"+e.split(":")[1];return n}(t.lotteryTime)+"</p></div>"}(n)+"</li>")})},r=function(e){t.router.load("duobao.html?treasureId="+e)},s=function(){t.each(new Array(1e3),function(t){clearInterval(t)}),t.each(new Array(t(".remaining").length),function(t){clearInterval(t)})},i=function(){t.showIndicator(),s(),t("#p-results").find(".results-list li").remove(),setTimeout(function(){e(1)},200)},o=function(n){t(document).off("infinite","#p-results .infinite-scroll");var r=!1;t(document).on("infinite","#p-results .infinite-scroll",function(){r||t(".results-list li").length<10||(r=!0,t.showIndicator(),setTimeout(function(){t.getUrlParam("treasureId");return totalPage&&n>=totalPage?void setTimeout(function(){t.hideIndicator(),t(".z_p_loadmore").html("没有更多数据"),t.toast("没有更多数据",1e3,"toast-80"),r=!1},200):void e(n+1,function(){setTimeout(function(){t.hideIndicator(),t.toast("加载成功",1e3,"toast-80"),r=!1},100)})},100))})},a=function(){t(".remaining").each(function(e,n){var r=function(t,e){return(Array(e).join("0")+t).substr(-e)},s=parseInt(t(n).attr("name")),s=100*s;setInterval(function(){s-=1;var e=Math.floor(s/100/60/60)>9?Math.floor(s/100/60/60):"0"+Math.floor(s/100/60/60),o=Math.floor((s/100-3600*e)/60)>9?Math.floor((s/100-3600*e)/60):"0"+Math.floor((s/100-3600*e)/60),a=Math.floor(s/100%60)>9?Math.floor(s/100%60):"0"+Math.floor(s/100%60),l=r(Math.floor(s%1e3),2);0==e?t(n).html(o+":"+a+":"+l):t(n).html(e+":"+o+":"+a+":"+l),s<=0&&(clearInterval(this),t(n).html("获取中"),setTimeout(function(){i()},1e3))},10)})},l=function(){s(),t("#p-results").find(".results-list li").remove(),t(document).off("infinite","#p-results .infinite-scroll"),e(1)};return{init:l,refresh:i,remaining:a,toDetail:r}}(Zepto);$(function(){requestInit()});